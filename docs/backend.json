{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application, storing their core profile information and role.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the user." },
        "firstName": { "type": "string", "description": "The first name of the user." },
        "lastName": { "type": "string", "description": "The last name of the user." },
        "email": { "type": "string", "description": "The email address of the user.", "format": "email" },
        "role": { "type": "string", "description": "The role of the user, which determines their access level (e.g., 'user', 'admin')." },
        "artisanProfileId": { "type": "string", "description": "Reference to ArtisanProfile. (Relationship: User 1:1 ArtisanProfile, if the user is an artisan)" }
      },
      "required": ["id", "firstName", "lastName", "email", "role"]
    },
    "ArtisanProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ArtisanProfile",
      "type": "object",
      "description": "Represents the profile of an artisan, showcasing their skills, experience, and story.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the artisan profile." },
        "userId": { "type": "string", "description": "Reference to User. (Relationship: User 1:1 ArtisanProfile)" },
        "bio": { "type": "string", "description": "A detailed biography of the artisan." },
        "skills": { "type": "array", "description": "An array of skills possessed by the artisan.", "items": { "type": "string" } },
        "experience": { "type": "string", "description": "A description of the artisan's experience." }
      },
      "required": ["id", "userId", "bio", "skills", "experience"]
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product listed by an artisan.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the product." },
        "artisanId": { "type": "string", "description": "Reference to ArtisanProfile. (Relationship: ArtisanProfile 1:N Product)" },
        "name": { "type": "string", "description": "The name of the product." },
        "description": { "type": "string", "description": "A detailed description of the product." },
        "images": { "type": "array", "description": "An array of image URLs for the product.", "items": { "type": "string" } },
        "mrp": { "type": "number", "description": "The Maximum Retail Price of the product." },
        "category": { "type": "string", "description": "The category of the product." },
        "hsn": { "type": "string", "description": "Harmonized System of Nomenclature code for the product." },
        "gst": { "type": "number", "description": "The applicable GST percentage for the product." },
        "size": {
          "type": "object",
          "description": "The dimensions of the product (optional).",
          "properties": {
            "height": { "type": "number", "description": "Height of the product." },
            "length": { "type": "number", "description": "Length of the product." },
            "width": { "type": "number", "description": "Width of the product." }
          }
        }
      },
      "required": ["id", "artisanId", "name", "description", "images", "mrp", "category", "gst"]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents an order placed by a customer.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the order." },
        "customerId": { "type": "string", "description": "Reference to User. (Relationship: User 1:N Order, representing the customer)" },
        "orderDate": { "type": "string", "description": "The date the order was placed.", "format": "date-time" },
        "totalAmount": { "type": "number", "description": "The total amount of the order." },
        "status": { "type": "string", "description": "The status of the order (e.g., 'pending', 'shipped', 'delivered')." },
        "returnStatus": { "type": "string", "description": "The status of any return associated with this order (e.g., 'none', 'requested', 'approved', 'rejected', 'refunded')." },
        "orderItemIds": { "type": "array", "description": "References to OrderItems. (Relationship: Order 1:N OrderItem)", "items": { "type": "string" } },
        "gstAmount": { "type": "number", "description": "The total GST amount for the order." },
        "cgstAmount": { "type": "number", "description": "The CGST component of the total tax." },
        "sgstAmount": { "type": "number", "description": "The SGST component of the total tax." },
        "igstAmount": { "type": "number", "description": "The IGST component of the total tax." }
      },
      "required": ["id", "customerId", "orderDate", "totalAmount", "status"]
    },
    "OrderItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OrderItem",
      "type": "object",
      "description": "Represents an item within an order.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the order item." },
        "orderId": { "type": "string", "description": "Reference to Order. (Relationship: Order 1:N OrderItem)" },
        "productId": { "type": "string", "description": "Reference to Product. (Relationship: Product 1:N OrderItem)" },
        "quantity": { "type": "number", "description": "The quantity of the product in the order item." },
        "price": { "type": "number", "description": "The price of the product in the order item (may differ from current product price)." }
      },
      "required": ["id", "orderId", "productId", "quantity", "price"]
    },
    "Review": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Review",
      "type": "object",
      "description": "Represents a review of a product or artisan.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the review." },
        "customerId": { "type": "string", "description": "Reference to User. (Relationship: User 1:N Review, representing the customer who wrote the review)" },
        "productId": { "type": "string", "description": "Reference to Product. (Relationship: Product 1:N Review).  If reviewing an artisan, this will be null." },
        "artisanId": { "type": "string", "description": "Reference to ArtisanProfile. (Relationship: ArtisanProfile 1:N Review). If reviewing a product, this will be null." },
        "rating": { "type": "number", "description": "The rating given by the customer (e.g., 1-5 stars)." },
        "comment": { "type": "string", "description": "The comment provided by the customer." },
        "reviewDate": { "type": "string", "description": "The date the review was submitted.", "format": "date-time" }
      },
      "required": ["id", "customerId", "rating", "comment", "reviewDate"]
    },
    "TeamMember": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TeamMember",
      "type": "object",
      "description": "Represents a member of the store's team.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the team member." },
        "name": { "type": "string", "description": "The full name of the team member." },
        "role": {
          "type": "string",
          "description": "The role or position of the team member.",
          "enum": ["Founder", "Management", "Team Member"]
        },
        "bio": { "type": "string", "description": "A short biography of the team member." },
        "image": { "type": "string", "description": "A URL to the team member's profile picture." }
      },
      "required": ["id", "name", "role", "bio", "image"]
    },
    "Store": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Store",
      "type": "object",
      "description": "Represents a single physical store location.",
      "properties": {
        "id": { "type": "string", "description": "The unique identifier for the store." },
        "name": { "type": "string", "description": "The public name of the store." },
        "address": { "type": "string", "description": "The physical address of the store." },
        "phone": { "type": "string", "description": "The contact phone number for the store." },
        "image": { "type": "string", "description": "A URL to an image of the store." },
        "googleMapsLink": { "type": "string", "description": "A URL to the store's location on Google Maps.", "format": "uri" }
      },
      "required": ["id", "name", "address", "googleMapsLink"]
    },
    "ShippingAddress": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ShippingAddress",
      "type": "object",
      "description": "Represents a user's saved shipping address.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the address." },
        "userId": { "type": "string", "description": "Reference to the User this address belongs to." },
        "name": { "type": "string", "description": "Recipient's full name." },
        "address": { "type": "string", "description": "Street address." },
        "city": { "type": "string", "description": "City." },
        "state": { "type": "string", "description": "State or province." },
        "pincode": { "type": "string", "description": "Postal or ZIP code." },
        "phone": { "type": "string", "description": "Recipient's phone number." }
      },
      "required": ["id", "userId", "name", "address", "city", "state", "pincode", "phone"]
    },
    "CompanySettings": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CompanySettings",
      "type": "object",
      "description": "Stores company details for invoices and general branding.",
      "properties": {
        "companyName": { "type": "string", "description": "The legal name of the company." },
        "companyAddress": { "type": "string", "description": "The full address of the company." },
        "gstin": { "type": "string", "description": "The company's GST Identification Number." },
        "bankName": { "type": "string", "description": "The name of the company's bank." },
        "accountNumber": { "type": "string", "description": "The company's bank account number." },
        "ifscCode": { "type": "string", "description": "The IFSC code for the company's bank account." },
        "invoiceLogoUrl": { "type": "string", "description": "A URL to the company's logo for invoices.", "format": "uri" }
      },
      "required": ["companyName", "companyAddress"]
    },
    "ReturnRequest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ReturnRequest",
      "type": "object",
      "description": "Represents a customer's request to return items from an order.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the return request." },
        "orderId": { "type": "string", "description": "Reference to the original Order." },
        "customerId": { "type": "string", "description": "Reference to the User who made the request." },
        "requestDate": { "type": "string", "description": "The date the return was requested.", "format": "date-time" },
        "reason": { "type": "string", "description": "The reason for the return, e.g., 'damaged-item'." },
        "status": { "type": "string", "description": "The status of the request, e.g., 'pending-review', 'approved', 'rejected', 'refunded'." },
        "items": { 
          "type": "array", 
          "description": "The specific items being returned.", 
          "items": { 
            "type": "object",
            "properties": {
              "productId": { "type": "string" },
              "productName": { "type": "string" },
              "quantity": { "type": "number" },
              "price": { "type": "number" }
            }
          }
        },
        "customerComments": { "type": "string", "description": "Customer's detailed comments about the damage." },
        "damageImages": { "type": "array", "description": "URLs of images uploaded by the customer showing the damage.", "items": { "type": "string", "format": "uri" } }
      },
      "required": ["id", "orderId", "customerId", "requestDate", "reason", "status", "items"]
    }
  },
  "auth": {
    "providers": ["password", "anonymous"]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": { "entityName": "User", "schema": { "$ref": "#/backend/entities/User" }, "description": "Stores user data, including role (user, admin). Enables role-based access control.", "params": [{ "name": "userId", "description": "The unique identifier of the user." }] }
      },
      {
        "path": "/users/{userId}/shippingAddresses/{addressId}",
        "definition": { "entityName": "ShippingAddress", "schema": { "$ref": "#/backend/entities/ShippingAddress" }, "description": "Stores a user's saved shipping addresses.", "params": [{ "name": "userId", "description": "The unique identifier of the user." }, { "name": "addressId", "description": "The unique identifier of the shipping address." }] }
      },
      {
        "path": "/artisanProfiles/{artisanProfileId}",
        "definition": { "entityName": "ArtisanProfile", "schema": { "$ref": "#/backend/entities/ArtisanProfile" }, "description": "Stores artisan profile information.", "params": [{ "name": "artisanProfileId", "description": "The unique identifier of the artisan profile." }] }
      },
      {
        "path": "/products/{productId}",
        "definition": { "entityName": "Product", "schema": { "$ref": "#/backend/entities/Product" }, "description": "Stores product information listed by artisans.", "params": [{ "name": "productId", "description": "The unique identifier of the product." }] }
      },
      {
        "path": "/orders/{orderId}",
        "definition": { "entityName": "Order", "schema": { "$ref": "#/backend/entities/Order" }, "description": "Stores order information placed by customers.", "params": [{ "name": "orderId", "description": "The unique identifier of the order." }] }
      },
      {
        "path": "/orderItems/{orderItemId}",
        "definition": { "entityName": "OrderItem", "schema": { "$ref": "#/backend/entities/OrderItem" }, "description": "Stores individual items within an order.", "params": [{ "name": "orderItemId", "description": "The unique identifier of the order item." }] }
      },
      {
        "path": "/reviews/{reviewId}",
        "definition": { "entityName": "Review", "schema": { "$ref": "#/backend/entities/Review" }, "description": "Stores customer reviews of products or artisans.", "params": [{ "name": "reviewId", "description": "The unique identifier of the review." }] }
      },
      {
        "path": "/teamMembers/{memberId}",
        "definition": { "entityName": "TeamMember", "schema": { "$ref": "#/backend/entities/TeamMember" }, "description": "Stores information about team members.", "params": [{ "name": "memberId", "description": "The unique identifier of the team member." }] }
      },
      {
        "path": "/stores/{storeId}",
        "definition": { "entityName": "Store", "schema": { "$ref": "#/backend/entities/Store" }, "description": "Stores details for each physical store location.", "params": [{ "name": "storeId", "description": "The unique identifier for the store." }] }
      },
      {
        "path": "/companySettings/main",
        "definition": { "entityName": "CompanySettings", "schema": { "$ref": "#/backend/entities/CompanySettings" }, "description": "A singleton document storing company-wide settings for invoices and branding." }
      },
      {
        "path": "/returnRequests/{returnRequestId}",
        "definition": { "entityName": "ReturnRequest", "schema": { "$ref": "#/backend/entities/ReturnRequest" }, "description": "Stores customer return requests for admin review.", "params": [{ "name": "returnRequestId", "description": "The unique identifier for the return request." }] }
      }
    ],
    "reasoning": "The Firestore structure is designed to manage users, artisans, products, orders, reviews, team members, and store details for the 'purbanchal hasta udyog' application. It prioritizes security, scalability, and ease of debugging.\n\n**Authorization Independence:** User roles are stored in the `/users` collection, allowing security rules to validate admin privileges with a single `get()` call.\n\n**Structural Segregation:** Each data model is in its own top-level collection. This isolates security concerns. User data is in `/users`, products in `/products`, and admin-managed content like `/teamMembers` and `/stores` are also in top-level collections. A new `/returnRequests` collection is added to manage customer returns, with rules to ensure customers can only manage their own requests while admins have full access.\n\n**Access Modeling:** Path-based ownership secures user data. A user's shipping addresses are stored in a subcollection `/users/{userId}/shippingAddresses` to ensure they are private and can only be accessed by the user or an admin. Role-based access control (RBAC) is used for the admin panel, with the `isAdmin()` function checking the `role` field in a user's document. The new `/teamMembers` and `/stores` collections are publicly readable but writable only by admins, ensuring content integrity. A new singleton document at `/companySettings/main` is added to store invoice and company details, writable only by admins."
  }
}
